<app-project-select [currentProjectName]="project.name" />
<div class="wrapper">
  <div class="roleCard" tuiAppearance="neutral" tuiCardMedium>
    <h2 tuiTitle>Роль в проекте {{ (project$ | async)?.name }}</h2>
    <p class="role" tuiSubtitle>{{ role }}</p>
  </div>

  <div class="categories">
    @for (category of project.categories; track category.id) {
    <app-category-card
      [category]="category"
      [tasks]="getTasksByCategoryId(category.id)"
      (deleteCategory)="onDeleteCategory(category.id)"
      (addTask)="onAddTask($event, category.id)"
      (deleteTask)="onDeleteTask($event)"
    />
    }
    <button
      class="categoryButton"
      appearance="secondary"
      size="l"
      tuiButton
      type="button"
      (click)="showDialog(template)"
    >
      <tui-icon icon="@tui.plus" [style.height.rem]="1" />
      Добавить категорию
    </button>
  </div>

  <ng-template #template let-observer>
    <h2>Добавить категорию</h2>
    <form
      [formGroup]="newCategoryForm"
      (ngSubmit)="createNewCategory(); observer.complete()"
      class="form"
    >
      <tui-input formControlName="name">
        Название категории
        <input tuiTextfieldLegacy type="text" />
      </tui-input>
      <div class="error">
        <small *ngIf="newCategoryForm.errors?.['match']"
          >Название категории должно быть уникальным</small
        >
      </div>
      <button tuiButton type="submit" [disabled]="newCategoryForm.invalid">
        Добавить
      </button>
    </form>
  </ng-template>
</div>
